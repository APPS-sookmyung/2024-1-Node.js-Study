# [6주차]섹션 3. 5-8

쿠키와 세션

로그인, 로그아웃을 할 때 알아두어야 하는 개념이다. 

요청을 받을 때 누가 요청을 보냈는지 알 수 없다. 따라서 로그인을 구현해서 누구인지 찾아야 한다. 

“쿠키: 키(속성명) = 값(속성값)”의 쌍

처음에 브라우저가 요청을 보내면 서버가 쿠키를 넣어서 보내준 다음 브라우저는 쿠키를 포함해서 저장해두고 쿠키와 함께 요청하면 누가 요청했는지 알 수 있게 된다. → 그럼 쿠키를 넣는 과정을 구현하면 되겠다!

```jsx
const http = require('http');

http.createServer((req, res) => {
    console.log(req.url, req.headers.cookie); //url은 슬래시, 그리고 my cookie는 test로 전달된다. 
    res.writeHead(200, { 'Set-Cookie': 'mycookie=test'}); //mycookie의 키와 값 관계?
    res.end('Hello Cookie');
})
    .listen(8083, () => {
        console.log('8083번 포트에서 서버 대기 중입니다. ')
    });
```

처음 과정에서 set-cookie로 쿠키를 보내고 나중에 것들은 자동으로 cookie가 전달된다. 

요청은 헤더와 바디(데이터) 응답도 헤더와 바디(데이터)로 구성되어 있는데 쿠키도 부가적인 정보이므로 헤더에 저장하게 된다. 

/favicon.ico: 는 크롬에서 브라우저 아이콘을 띄우기 위해 자동으로 열리는 요청이다. 

cookie2

로그인 입력을 완료하면 get요청에 [http://localhost:8084/login?name=권유진](http://localhost:8084/login?name=%EA%B6%8C%EC%9C%A0%EC%A7%84)라는 링크가 생성된다. 

'Set-Cookie': `name=${encodeURIComponent(name)}; Expires=${expires.toGMTString()}; HttpOnly; Path=/`,

encodeURLComponent: name값이 한글이기 때문에 넣어서 인식되도록 해주어야 한다. 

Expires= $(expires.toGMTString());: Expires는 쿠키의 만료 기간을 지정하는 것으로 만약 지정해주지 않으면 Session 쿠키로, 브라우저를 종료하면 쿠키가 사라진다. 그리고 현재 입력한대로 따른다면 5분 로그인이 유지되는 상태이다. 

HttpOnly: HTML으로 쿠키에 접근하는 경우를 막기 위해 Http의 접근만 허용한다. 로그인 쿠키는 이 과정이 거의 필수적이다. 

Prth =/: locahost포트번호 그리고 /뒤의 쿠키는 모두 유효하다는 표시이다. 

같은 / 주소라도 쿠키의 유무에 따라서 다른 화면을 표시할 수 있다. 

세션

중요한 정보를 담은 쿠키를 브라우저에 그대로 담을 경우 보안이 위험할 수 있다. 이럴 때 적용하는 것이 세션이라고 한다. 

만약 브라우저 내에서 조건을 만족하면(유효기간을 넘지 않았을 경우…)session으로 name을 다시 꺼내서 처음에 저장한 쿠키를 가져온다. 

https(http와 다른 것)

header에 정보가 너무 자세하게 나올 경우 보안의 안전성이 보장되지 않는다. 따라서 https를 적용해서 전달을 하면 암호화된 상태로 전달된다. 

http2

http보다 발전된 연결 구조로 동시적으로 더 빠르게 실행할 수 있게 되었다. https도 같이 적용하면 속도와 보안 다 챙길 수 있다. (실무로 적용할때는 http2!)

클러스터(cluster) 

싱글 스레드인 노드를 CPU코어 개수만큼 모두 사용할 수 있게 해주는 모듈이다. 단점은 메모리나 세션 등을 공유할 수 없다.(서버가 많으면 새로고침 할 때 마다 로그인이 유지되지 않는다…)

프로세스를 여러개 만드는 것. 그리고 여러개의 서버를 하나의 포트에 연결할 수 있고 포트의 요청을 어떠한 규칙으로 서버에 배분해서 실행한다. (실행결과 16개)

클러스터 적용, 그리고 오류가 나서 꺼지더라도 다시 자동으로 켜지는 형태로 구성해주어야 한다.