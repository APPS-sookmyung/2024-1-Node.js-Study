# 6주차

## 1. 쿠키 이해하기

- 서버는 요청을 보냈는지 알 수가 없음 ( ip주소와 브라우저 정보 정도만 앎)
    - 로그인을 구현하여 그 요청이 누군지를 알아내면 됨
    - 쿠키와 세션이 필요
- 쿠키 : 키 = 값의 쌍
    - 매 요청마다 서버에 동봉해서 보냄
    - 브라우저가 알아서 서버에 쿠키를 보냄

## 2. 쿠키 구현

- 쿠키 넣는 것을 직접 구현
    - writeHead : 요청 헤더에 입력하는 매서드
    - Set-Cookie : 브라우저에서 쿠키를 설정하라고 명령
    - http 요청과 응답은 헤더와 본문을 가짐
        - 헤더 : 요청 / 응답에 대한 정보
        - 본문 : 주고받는 실제 데이터
        - 쿠키 : 부가적인 정보 → 헤더에 저장 (화면에 보이는게 아님)
    - 302 : redirect
    - 세션 쿠키 : 브라우저를 끄는 순간 쿠키가 사라짐
    - 만료시간을 적어주면 만료시간이 지나면 쿠키가 사라짐 → 브라우저가 꺼지지 않더라도 유효시간이 지나면 브라우저가 알아서 쿠키를 지워줌
    - HttpOnly : js 로 쿠키에 접근하지 못하도록 ← 보안에 문제가 됨 (로그인)
    - Path=/ : path 아래 있는 주소에서 쿠키가 유효
    - 개발자 도구만 사용할 줄 안다면 누구나 볼 수 있고 조작도 가능함

## 3. 세션 사용하기

- 중요한 정보는 서버가 가지고 있고 key만 브라우저로
- key는 임의로 정하면 되지만 남이랑 같다면 내가 로그인했는데 다른사람이 로그인되는 경우가 있을 수 있음

```jsx
const uniqueInt = Date.now(); 
      session[uniqueInt] = {
        name,
        expires,
      };
```

- 브라우저에는 uniqeInt만 보내는 것

## 4. https, http2

- https
    - 웹 서버 SLL 암호화를 추가하는 모듈
        - 오고가는 데이터를 암호화해서 중간에 다른 사람이 요청을 가로체더라도 내용을 확인할 수 없음
        - 요즘에서는 https 적용이 필수(개인 정보가 있는 곳은 특히) - 실수에서는 거의 필수
        - 인증서를 인정기관 (letsencrypt) 에서 얻어와야함 - 인증이되면 cert, ket, ca 파일을 줌
        - sync를 쓰는 이유 - 딱 한번 실행, 서버 : 초기화할 때
        
        ```jsx
        cert: fs.readFileSync("도메인 인증서 경로"),
              key: fs.readFileSync("도메인 비밀키 경로"),
              ca: [
                fs.readFileSync("상위 인증서 경로"),
                fs.readFileSync("상위 인증서 경로"),
              ],
        ```
        
        - 포트는 443
- http2
    - 웹의 속도도 개선됨
    - 동시의 여러 요청을 보낼 수 있음

## 5. cluster

- 실무에서는 http2를 하면서 cluster까지 해서 배포하는 것이 좋음
- 기본적으로 싱글 스레드인 노드가 CPU 코어를 모두 사용할 수 있게 해주는 모듈
    - 코어를 하나만 사용함
        - 서버를 코어 개수만큼 실행 - 효율적
        - 성능이 비례하는 것은 아님
        - 단점 : 컴퓨터 자원 공유 못 함
            - 로그인이 한 서버에서는 되어 있고 다른 서버에서는 안되어 있는 문제가 있을 수 있음
        - Redis 등 별도 서버로 해결 가능
        - const numCPUs = require('os').cpus().length; - cpu 개수 만큼 알아서 실행해줌
        - cluster는 여러개의 서버를 하나의 포트에 묶어둘 수 있음
        - cluster.fork(); → 실무에서는 이렇게 자주씀
            - 에러가 나서 종료가 되더라도 서버를 살리도록 해줌